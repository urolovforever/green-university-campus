// Translations
const translations = {
    uz: {
        nav: {
            about: 'Biz haqimizda',
            programs: 'Dasturlar',
            events: 'Tadbirlar',
            team: 'Jamoa',
            contacts: 'Aloqa',
            join: 'Qo\'shilish'
        },
        hero: {
            tag: 'Barqaror rivojlanish tashabbusi',
            title1: 'Universitetlar bilan birga',
            title2: ' yashil ',
            title3: 'kelajak yaratamiz',
            subtitle: 'Green Campus Initiative talabalar, o\'qituvchilar va ma\'muriyatni ekologik barqaror ta\'lim muhitini yaratish uchun birlashtiradi',
            startNow: 'Hozir boshlash',
            watchVideo: 'Videoni ko\'rish'
        },
        stats: [
            { label: 'Uglerod izini kamaytirish' },
            { label: 'Faol ishtirokchilar' },
            { label: 'Hamkor universitetlar' },
            { label: 'Ekilgan daraxtlar' }
        ],
        scroll: 'Pastga aylantiring',
        about: {
            tag: 'Green Campus Initiative haqida',
            title: 'Avlodlarni birlashtiruvchi missiya',
            p1: '2018-yildan beri biz har bir universitet kampusini ekologik mas\'uliyat namunasiga aylantirishga intilamiz. Bizning missiyamiz nafaqat hududlarni ko\'kalamzorlashtirish, balki barqaror rivojlanish madaniyatini yaratishdir.',
            p2: 'Biz ishonamizki, universitetlar devorlarida jamiyatning atrof-muhitga munosabatini o\'zgartiradigan yetakchilar shakllanadi.',
            values: [
                { title: 'Ilm va innovatsiya', desc: 'Tadqiqotlarga asoslangan yechimlar' },
                { title: 'Jamoa', desc: 'Butun mamlakat bo\'ylab faollarni birlashtiramiz' },
                { title: 'Barqarorlik', desc: 'Uzoq muddatli ekologik yechimlar' }
            ],
            imageLabel: 'Bizning ko\'ngillilar faoliyatda',
            award: '"Yilning yashil kampusi" mukofoti 2024'
        },
        programs: {
            tag: 'Bizning dasturlarimiz',
            title: 'Kampus ekologiyasiga kompleks yondashuv',
            subtitle: 'Universitetlarni barqaror rivojlanish markazlariga aylantiradigan to\'rtta asosiy yo\'nalish',
            items: [
                { title: 'Yashil Kampus', description: 'Universitet hududlarini ekologizatsiya qilish kompleks dasturi: ko\'kalamzorlashtirish, chiqindilarni saralash.' },
                { title: 'Eko-Laboratoriyalar', description: 'Barqaror rivojlanish uchun innovatsion yechimlar ishlab chiquvchi talabalar tadqiqot guruhlari.' },
                { title: 'Toza Energiya', description: 'Kampuslarni qayta tiklanadigan energiya manbalariga o\'tkazish: quyosh panellari, shamol generatorlari.' },
                { title: 'Nol Chiqindi', description: 'Qayta ishlash, kompostlash va ongli iste\'mol orqali chiqindilarni minimallashtirish dasturi.' }
            ],
            learnMore: 'Batafsil'
        },
        impact: {
            tag: 'Bizning ta\'sirimiz',
            title: '6 yil davomida biz universitet kampusi qanday bo\'lishi mumkinligi haqidagi tasavvurni o\'zgartirdik',
            stats: [
                { number: '156', label: 'Amalga oshirilgan eko-loyihalar' },
                { number: '$2M', label: 'Jalb qilingan moliyalashtirish' },
                { number: '320', label: 'Tonna CO₂ kompensatsiya qilindi' }
            ],
            report: 'Yillik hisobotni o\'qish'
        },
        events: {
            tag: 'Tadbirlar taqvimi',
            title: 'Yaqinlashib kelayotgan tadbirlar',
            allEvents: 'Barcha tadbirlar',
            register: 'Ro\'yxatdan o\'tish',
            items: [
                { date: '15', month: 'Yan', title: 'Eko-forum 2025', location: 'Toshkent, O\'zbekiston' },
                { date: '22', month: 'Fev', title: 'Daraxt ekish kuni', location: 'Barcha kampuslar' },
                { date: '05', month: 'Mar', title: 'GreenTech Hackathon', location: 'Samarqand' },
                { date: '22', month: 'Apr', title: 'Yer kuni', location: 'Onlayn + oflayn' }
            ]
        },
        team: {
            tag: 'Bizning jamoa',
            title: 'Buni amalga oshirayotgan odamlar',
            members: [
                { name: 'Aziza Yashilova', role: 'Asoschisi va direktori' },
                { name: 'Jasur Tabiatov', role: 'Dasturlar koordinatori' },
                { name: 'Nilufar Ekova', role: 'Ilmiy maslahatchi' },
                { name: 'Bobur Kampusov', role: 'Universitetlar bilan aloqa' }
            ]
        },
        cta: {
            title: 'Kampusingizni yashil qilishga tayyormisiz?',
            subtitle: 'Barqaror kelajak uchun harakatga qo\'shiling. Birgalikda ko\'proq narsaga erishamiz!',
            partner: 'Hamkor bo\'lish',
            volunteer: 'Ko\'ngilli bo\'lish'
        },
        footer: {
            desc: 'Kelajak ta\'limi uchun ekologik barqaror kampuslar yaratamiz',
            navigation: 'Navigatsiya',
            resources: 'Resurslar',
            contacts: 'Aloqa',
            links: ['Biz haqimizda', 'Dasturlar', 'Tadbirlar', 'Yangiliklar'],
            resourceLinks: ['Uslubiy materiallar', 'Tadqiqotlar', 'TSS', 'OAV uchun'],
            copyright: '© 2025 Green Campus Initiative. Barcha huquqlar himoyalangan.',
            privacy: 'Maxfiylik siyosati',
            terms: 'Foydalanish shartlari'
        }
    },
    ru: {
        nav: {
            about: 'О нас',
            programs: 'Программы',
            events: 'События',
            team: 'Команда',
            contacts: 'Контакты',
            join: 'Присоединиться'
        },
        hero: {
            tag: 'Инициатива устойчивого развития',
            title1: 'Создаём',
            title2: ' зелёное ',
            title3: 'будущее вместе с университетами',
            subtitle: 'Green Campus Initiative объединяет студентов, преподавателей и администрацию для создания экологически устойчивых образовательных пространств',
            startNow: 'Начать сейчас',
            watchVideo: 'Смотреть видео'
        },
        stats: [
            { label: 'Снижение углеродного следа' },
            { label: 'Активных участников' },
            { label: 'Партнёрских вузов' },
            { label: 'Посаженных деревьев' }
        ],
        scroll: 'Листайте вниз',
        about: {
            tag: 'О Green Campus Initiative',
            title: 'Миссия, которая объединяет поколения',
            p1: 'С 2018 года мы работаем над тем, чтобы каждый университетский кампус стал примером экологической ответственности. Наша миссия — не просто озеленение территорий, а создание культуры устойчивого развития.',
            p2: 'Мы верим, что именно в стенах университетов формируются лидеры, которые изменят отношение общества к окружающей среде.',
            values: [
                { title: 'Наука и инновации', desc: 'Решения, основанные на исследованиях' },
                { title: 'Сообщество', desc: 'Объединяем активистов со всей страны' },
                { title: 'Устойчивость', desc: 'Долгосрочные экологические решения' }
            ],
            imageLabel: 'Наши волонтёры в действии',
            award: 'Премия «Зелёный кампус года» 2024'
        },
        programs: {
            tag: 'Наши программы',
            title: 'Комплексный подход к экологии кампуса',
            subtitle: 'Четыре ключевых направления, которые трансформируют университеты в центры устойчивого развития',
            items: [
                { title: 'Зелёный Кампус', description: 'Комплексная программа экологизации университетских территорий: озеленение, раздельный сбор отходов.' },
                { title: 'Эко-Лаборатории', description: 'Студенческие исследовательские группы, разрабатывающие инновационные решения для устойчивого развития.' },
                { title: 'Чистая Энергия', description: 'Переход кампусов на возобновляемые источники энергии: солнечные панели, ветрогенераторы.' },
                { title: 'Ноль Отходов', description: 'Программа минимизации отходов через переработку, компостирование и осознанное потребление.' }
            ],
            learnMore: 'Подробнее'
        },
        impact: {
            tag: 'Наше влияние',
            title: 'За 6 лет мы изменили представление о том, каким может быть университетский кампус',
            stats: [
                { number: '156', label: 'Эко-проектов реализовано' },
                { number: '₽45M', label: 'Привлечено финансирования' },
                { number: '320', label: 'Тонн CO₂ компенсировано' }
            ],
            report: 'Читать годовой отчёт'
        },
        events: {
            tag: 'Календарь событий',
            title: 'Ближайшие мероприятия',
            allEvents: 'Все события',
            register: 'Регистрация',
            items: [
                { date: '15', month: 'Янв', title: 'Эко-форум 2025', location: 'МГУ, Москва' },
                { date: '22', month: 'Фев', title: 'День посадки деревьев', location: 'Все кампусы' },
                { date: '05', month: 'Мар', title: 'Хакатон GreenTech', location: 'СПбГУ' },
                { date: '22', month: 'Апр', title: 'День Земли', location: 'Онлайн + офлайн' }
            ]
        },
        team: {
            tag: 'Наша команда',
            title: 'Люди, которые делают это возможным',
            members: [
                { name: 'Анна Лесникова', role: 'Основатель и директор' },
                { name: 'Михаил Зеленин', role: 'Координатор программ' },
                { name: 'Елена Природина', role: 'Научный консультант' },
                { name: 'Дмитрий Экович', role: 'Связи с университетами' }
            ]
        },
        cta: {
            title: 'Готовы сделать ваш кампус зелёным?',
            subtitle: 'Присоединяйтесь к движению за устойчивое будущее. Вместе мы можем больше!',
            partner: 'Стать партнёром',
            volunteer: 'Стать волонтёром'
        },
        footer: {
            desc: 'Создаём экологически устойчивые кампусы для образования будущего',
            navigation: 'Навигация',
            resources: 'Ресурсы',
            contacts: 'Контакты',
            links: ['О нас', 'Программы', 'События', 'Новости'],
            resourceLinks: ['Методические материалы', 'Исследования', 'FAQ', 'Для СМИ'],
            copyright: '© 2025 Green Campus Initiative. Все права защищены.',
            privacy: 'Политика конфиденциальности',
            terms: 'Условия использования'
        }
    },
    en: {
        nav: {
            about: 'About',
            programs: 'Programs',
            events: 'Events',
            team: 'Team',
            contacts: 'Contact',
            join: 'Join Us'
        },
        hero: {
            tag: 'Sustainable Development Initiative',
            title1: 'Creating a',
            title2: ' green ',
            title3: 'future together with universities',
            subtitle: 'Green Campus Initiative unites students, faculty, and administration to create environmentally sustainable educational spaces',
            startNow: 'Get Started',
            watchVideo: 'Watch Video'
        },
        stats: [
            { label: 'Carbon Footprint Reduction' },
            { label: 'Active Participants' },
            { label: 'Partner Universities' },
            { label: 'Trees Planted' }
        ],
        scroll: 'Scroll down',
        about: {
            tag: 'About Green Campus Initiative',
            title: 'A Mission That Unites Generations',
            p1: 'Since 2018, we have been working to make every university campus a model of environmental responsibility. Our mission is not just about greening territories, but creating a culture of sustainable development.',
            p2: 'We believe that it is within university walls that leaders are formed who will change society\'s attitude towards the environment.',
            values: [
                { title: 'Science & Innovation', desc: 'Research-based solutions' },
                { title: 'Community', desc: 'Uniting activists across the country' },
                { title: 'Sustainability', desc: 'Long-term environmental solutions' }
            ],
            imageLabel: 'Our volunteers in action',
            award: '"Green Campus of the Year" Award 2024'
        },
        programs: {
            tag: 'Our Programs',
            title: 'A Comprehensive Approach to Campus Ecology',
            subtitle: 'Four key directions that transform universities into sustainable development centers',
            items: [
                { title: 'Green Campus', description: 'Comprehensive program for campus greening: landscaping, waste sorting, energy efficiency.' },
                { title: 'Eco-Labs', description: 'Student research groups developing innovative solutions for sustainable development.' },
                { title: 'Clean Energy', description: 'Transitioning campuses to renewable energy sources: solar panels, wind turbines.' },
                { title: 'Zero Waste', description: 'Waste minimization program through recycling, composting, and conscious consumption.' }
            ],
            learnMore: 'Learn More'
        },
        impact: {
            tag: 'Our Impact',
            title: 'In 6 years, we have changed the perception of what a university campus can be',
            stats: [
                { number: '156', label: 'Eco-projects Implemented' },
                { number: '$2M', label: 'Funding Raised' },
                { number: '320', label: 'Tons of CO₂ Offset' }
            ],
            report: 'Read Annual Report'
        },
        events: {
            tag: 'Event Calendar',
            title: 'Upcoming Events',
            allEvents: 'All Events',
            register: 'Register',
            items: [
                { date: '15', month: 'Jan', title: 'Eco-Forum 2025', location: 'Tashkent, Uzbekistan' },
                { date: '22', month: 'Feb', title: 'Tree Planting Day', location: 'All Campuses' },
                { date: '05', month: 'Mar', title: 'GreenTech Hackathon', location: 'Samarkand' },
                { date: '22', month: 'Apr', title: 'Earth Day', location: 'Online + Offline' }
            ]
        },
        team: {
            tag: 'Our Team',
            title: 'The People Making It Happen',
            members: [
                { name: 'Anna Greenwood', role: 'Founder & Director' },
                { name: 'Michael Rivers', role: 'Programs Coordinator' },
                { name: 'Elena Forest', role: 'Scientific Advisor' },
                { name: 'David Campus', role: 'University Relations' }
            ]
        },
        cta: {
            title: 'Ready to Make Your Campus Green?',
            subtitle: 'Join the movement for a sustainable future. Together we can do more!',
            partner: 'Become a Partner',
            volunteer: 'Become a Volunteer'
        },
        footer: {
            desc: 'Creating environmentally sustainable campuses for the education of the future',
            navigation: 'Navigation',
            resources: 'Resources',
            contacts: 'Contact',
            links: ['About', 'Programs', 'Events', 'News'],
            resourceLinks: ['Methodological Materials', 'Research', 'FAQ', 'For Media'],
            copyright: '© 2025 Green Campus Initiative. All rights reserved.',
            privacy: 'Privacy Policy',
            terms: 'Terms of Use'
        }
    }
};

// Current language
let currentLang = 'en';

// DOM Elements
const nav = document.getElementById('nav');
const gradientOrb = document.getElementById('gradientOrb');
const langBtn = document.getElementById('langBtn');
const langDropdown = document.getElementById('langDropdown');
const currentLangDisplay = document.getElementById('currentLang');
const heroStats = document.getElementById('heroStats');
const mobileMenuBtn = document.getElementById('mobileMenuBtn');
const navLinks = document.querySelector('.nav-links');

// Scroll handling
let scrollY = 0;
window.addEventListener('scroll', () => {
    scrollY = window.scrollY;
    
    if (scrollY > 50) {
        nav.classList.add('scrolled');
    } else {
        nav.classList.remove('scrolled');
    }
});

// Mouse tracking for gradient orb
document.addEventListener('mousemove', (e) => {
    gradientOrb.style.left = (e.clientX - 300) + 'px';
    gradientOrb.style.top = (e.clientY - 300) + 'px';
});

// Language selector
langBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    langDropdown.classList.toggle('open');
});

document.addEventListener('click', () => {
    langDropdown.classList.remove('open');
});

// Language option click
document.querySelectorAll('.lang-option').forEach(option => {
    option.addEventListener('click', (e) => {
        e.stopPropagation();
        const lang = option.dataset.lang;
        setLanguage(lang);
        langDropdown.classList.remove('open');
    });
});

// Set language function
function setLanguage(lang) {
    currentLang = lang;
    currentLangDisplay.textContent = lang.toUpperCase();
    
    // Update active state
    document.querySelectorAll('.lang-option').forEach(opt => {
        opt.classList.remove('active');
        if (opt.dataset.lang === lang) {
            opt.classList.add('active');
        }
    });
    
    // Update all translatable elements
    updateTranslations();
}

// Get nested translation value
function getNestedValue(obj, path) {
    return path.split('.').reduce((current, key) => {
        if (current && current[key] !== undefined) {
            return current[key];
        }
        return undefined;
    }, obj);
}

// Update translations
function updateTranslations() {
    const t = translations[currentLang];
    
    // Update nav links
    document.querySelectorAll('.nav-link').forEach(link => {
        const key = link.dataset.key;
        if (key && t.nav[key]) {
            link.textContent = t.nav[key];
        }
    });
    
    // Update all elements with data-i18n attribute
    document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.dataset.i18n;
        const value = getNestedValue(t, key);
        if (value !== undefined) {
            el.textContent = value;
        }
    });
    
    // Update program cards
    const programCards = document.querySelectorAll('.program-card');
    programCards.forEach((card, index) => {
        if (t.programs.items[index]) {
            const titleEl = card.querySelector('.program-title');
            const descEl = card.querySelector('.program-desc');
            if (titleEl) titleEl.textContent = t.programs.items[index].title;
            if (descEl) descEl.textContent = t.programs.items[index].description;
        }
    });
    
    // Update event cards
    const eventCards = document.querySelectorAll('.event-card');
    eventCards.forEach((card, index) => {
        if (t.events.items[index]) {
            const dayEl = card.querySelector('.event-day');
            const monthEl = card.querySelector('.event-month');
            const titleEl = card.querySelector('.event-title');
            const locationEl = card.querySelector('.event-location span');
            
            if (dayEl) dayEl.textContent = t.events.items[index].date;
            if (monthEl) monthEl.textContent = t.events.items[index].month;
            if (titleEl) titleEl.textContent = t.events.items[index].title;
            if (locationEl) locationEl.textContent = t.events.items[index].location;
        }
    });
    
    // Update team cards
    const teamCards = document.querySelectorAll('.team-card');
    teamCards.forEach((card, index) => {
        if (t.team.members[index]) {
            const nameEl = card.querySelector('.team-name');
            const roleEl = card.querySelector('.team-role');
            if (nameEl) nameEl.textContent = t.team.members[index].name;
            if (roleEl) roleEl.textContent = t.team.members[index].role;
        }
    });
    
    // Update footer links
    const footerLinks = document.querySelectorAll('.footer-column:first-child .footer-link');
    footerLinks.forEach((link, index) => {
        if (t.footer.links[index]) {
            link.textContent = t.footer.links[index];
        }
    });
    
    const resourceLinks = document.querySelectorAll('.footer-column:nth-child(2) .footer-link');
    resourceLinks.forEach((link, index) => {
        if (t.footer.resourceLinks[index]) {
            link.textContent = t.footer.resourceLinks[index];
        }
    });
    
    // Update impact stats
    const impactItems = document.querySelectorAll('.impact-item');
    impactItems.forEach((item, index) => {
        if (t.impact.stats[index]) {
            const numberEl = item.querySelector('.impact-number');
            const labelEl = item.querySelector('.impact-label');
            if (numberEl) numberEl.textContent = t.impact.stats[index].number;
            if (labelEl) labelEl.textContent = t.impact.stats[index].label;
        }
    });
}

// Animated counters
let countersAnimated = false;
const animatedNumbers = [0, 0, 0, 0];
const targetNumbers = [47, 12, 89, 2.3];

function animateCounters() {
    if (countersAnimated) return;
    
    const duration = 2000;
    const steps = 60;
    const interval = duration / steps;
    let step = 0;
    
    const timer = setInterval(() => {
        step++;
        targetNumbers.forEach((target, i) => {
            animatedNumbers[i] = Math.min(target, (target / steps) * step);
        });
        
        updateStatNumbers();
        
        if (step >= steps) {
            clearInterval(timer);
            countersAnimated = true;
        }
    }, interval);
}

function updateStatNumbers() {
    document.getElementById('stat0').textContent = Math.round(animatedNumbers[0]) + '%';
    document.getElementById('stat1').textContent = Math.round(animatedNumbers[1]) + 'K+';
    document.getElementById('stat2').textContent = Math.round(animatedNumbers[2]);
    document.getElementById('stat3').textContent = animatedNumbers[3].toFixed(1) + 'M';
}

// Intersection Observer for stats animation
const statsObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            animateCounters();
        }
    });
}, { threshold: 0.3 });

if (heroStats) {
    statsObserver.observe(heroStats);
}

// Program card hover effects (already handled by CSS)

// Smooth scroll for anchor links
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function(e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
            target.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }
    });
});

// Mobile menu toggle
if (mobileMenuBtn) {
    mobileMenuBtn.addEventListener('click', () => {
        mobileMenuBtn.classList.toggle('active');
        navLinks.classList.toggle('active');
    });

    // Close mobile menu when clicking on a link
    document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', () => {
            mobileMenuBtn.classList.remove('active');
            navLinks.classList.remove('active');
        });
    });

    // Close mobile menu when clicking outside
    document.addEventListener('click', (e) => {
        if (!nav.contains(e.target) && navLinks.classList.contains('active')) {
            mobileMenuBtn.classList.remove('active');
            navLinks.classList.remove('active');
        }
    });
}

// Initialize
document.addEventListener('DOMContentLoaded', () => {
    updateTranslations();
    if (heroStats) {
        updateStatNumbers();
    }
});